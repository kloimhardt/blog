---
layout: post
title:  "draft-sicmutils 1"
date:   2023-02-21 06:00:01 +0100
categories: Software
---
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="https://storage.googleapis.com/app.klipse.tech/css/codemirror.css">

    <script>
     window.klipse_settings = {
         selector_eval_js: '.language-klipse-eval-js'
     };
    </script>
</head>

<body>
    <pre><code class="language-klipse-eval-js">
var x = 1;
    </code></pre>
    <pre><code class="language-klipse-eval-js">
x/2;
    </code></pre>
    <pre><code class="language-klipse-eval-js">
var div = (x, y) => x/y;

div(x, 2);
    </code></pre>

    <pre>&lt;script src=&quot;http://kloimwieder.com/sicmutils/demo/out/main.js&quot;&gt;&lt;/script&gt;</pre>

    <script src="http://kloimwieder.com/sicmutils/demo/out/main.js"></script>

    <pre><code class="language-klipse-eval-js">
var div = sicmutils.env._SLASH_;

div(x, 2).toString();
    </code></pre>

    <pre><code class="language-klipse-eval-js">
"[ x / 2 ]".replace(/\//g,"div");
    </code></pre>

    <pre><code class="language-klipse-eval-js">
"[ x div 2 ]"
.replace(/(\w+)/g,'"$1",')
.replace(/\,\s\]/g," ]");
    </code></pre>

    <pre><code class="language-klipse-eval-js">
var text = "[ x / 2 ]"

var replaceMath = (txt) =>
txt.replace(/\//g,"div");

var insertCommas = (txt) =>
txt.replace(/(\w+)/g,'"$1",')
   .replace(/\,\s\]/g," ]");

var textToJson = (txt) =>
JSON.parse(insertCommas(replaceMath(txt)));

textToJson(text);
    </code></pre>

    <pre><code class="language-klipse-eval-js">
var text = "[ x / 2 ]"

var jsonToJs = (j) =>
j[1] + "(" +  j[0] + ", " + j[2] + ")";

jsonToJs(textToJson(text));

    </code></pre>

    <pre><code class="language-klipse-eval-js">
var text = "((x / 2) / 2)";

var makeBrackets = (txt) =>
txt.replace(/\(/g,"[ ")
.replace(/\)/g," ],")
.replace(/,$/,"");

var textToJson = (txt) =>
// old: JSON.parse(insertCommas(replaceMath(txt)))
JSON.parse(insertCommas(replaceMath(makeBrackets(txt))));

textToJson(text)
    </code></pre>

    <pre><code class="language-klipse-eval-js">
var text = "((x / 2) / 2)";

var jsonToJs = (j) =>
// old: j[1] + "(" +  j[0] + ", " + j[2] + ")"
j.constructor == Array
? jsonToJs(j[0]) + "(" +  j.slice(1).map(jsonToJs) + ")"
: j;

jsonToJs(textToJson(text));
    </code></pre>

    <pre><code class="language-klipse-eval-js">
var schemeCode = "(/ (/ x 2) 2)";

var schemeToJs = (expr) =>
jsonToJs(textToJson(expr)) + ".toString();";

schemeToJs(schemeCode);
    </code></pre>


    <pre>var oldEval = window.eval;

var newEval = (txt) =>
txt[0] === "("
? oldEval(schemeToJs(txt))
: oldEval(txt);

window.eval = newEval;</pre>

    <script>
     var oldEval = window.eval;
     var newEval = (txt) =>
         txt[0] === "("
         ? oldEval(schemeToJs(txt))
         : oldEval(txt);
     window.eval = newEval;
    </script>

    <pre><code class="language-klipse-eval-js">
div(div(x,2),2).toString();
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(/ (/ x 2) 2)
    </code></pre>


<script src="https://storage.googleapis.com/app.klipse.tech/plugin_prod/js/klipse_plugin.min.js"></script>
</body>
</html>
