<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="https://storage.googleapis.com/app.klipse.tech/css/codemirror.css">

    <script>
     window.klipse_settings = {
         selector_eval_js: '.language-klipse-eval-js'
     };
    </script>
</head>
<body>
    <h1>Header of this html file </h1>
    <pre>
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8"&gt;
        &lt;link rel="stylesheet" type="text/css" href="https://storage.googleapis.com/app.klipse.tech/css/codemirror.css"&gt;

        &lt;script&gt;
         window.klipse_settings = {
             selector_eval_js: '.language-klipse-eval-js'
         };
        &lt;/script&gt;
    &lt;/head&gt;
&lt;body&gt;
    &lt;script src=&quot;https://kloimhardt.github.io/blog/js/main.js&quot;&gt;&lt;/script&gt;

    &lt;script&gt;
      var loadEnv = (name) => {
          window[name] = sicmutils.env[name];
          return name;
      }
    &lt;/script&gt;</pre>

    <script src="https://kloimhardt.github.io/blog/js/main.js"></script>

    <script>
     var loadEnv = (name) => {
         window[name] = sicmutils.env[name];
         return name;
     }
    </script>

    <h1>Code blocks look like this</h1>

    <pre>
    &lt;pre&gt&lt;code class="language-klipse-eval-js"&gt
7 + 3
    &lt;/code&gt;&lt;/pre&gt
    </pre>

    <pre><code class="language-klipse-eval-js">
7 + 3
    </code></pre>

    <h1>Implement the Compiler</h1>

    <pre><code class="language-klipse-eval-js">
["pi", "_pi"].map(loadEnv);

var symbol = cljs.core.symbol;
var _COLON_pi = pi;
var __COLON_pi = _pi;

var specialchars =
[["_SYMBOL_$1", /\'(\w+)/g],
["$1_DOT_$2", /(\d+)\.(\d+)/g],
["__COLON_$1", /\-:(\w+)/g],
["_COLON_$1", /:(\w+)/g],
["[ / -$1 $2 ],", /-(\w+)\/(\d+)/g],
["[ / $1 $2 ],", /(\w+)\/(\d+)/g]];

var mathfns =
[["_SLASH_", /\//g],
["_STAR_", /\*/g],
["_", /\-/g],
["_PLUS_", /\+/g],
["expt", /\^/g]];

mathfns.map(x=> x[0]).map(loadEnv);

var replaceMath = (txt) =>
specialchars.concat(mathfns)
.reduce((s,r) => s.replace(r[1],r[0]), txt);

var swapFirst = (j) =>
j.constructor == Array && mathfns.map(x=> x[0]).includes(j[1])
? [j[1], j[0]].concat(j.slice(2)).map(swapFirst)
: j.constructor == Array
? j.map(swapFirst)
: j;

var insertCommas = (txt) =>
txt.replace(/(\w+)/g,'"$1",')
.replace(/\,\s+\]/g," ]");

var makeBrackets = (txt) =>
txt.trim()
.replace(/\(/g,"[ ")
.replace(/\)/g," ],")
.replace(/,$/,"");

var textToJson = (txt) =>
JSON.parse(insertCommas(replaceMath(makeBrackets(txt))));

var drv = sicmutils.env.D;

var specialchars_2 =
    [["$1.$2", /(\d+)_DOT_(\d+)/g],
     ["-$1", /_(\d+)/g]];

var replaceD = (j) =>
j.constructor == String && j == "D"
? "drv"
: j.constructor == String
? specialchars_2.reduce((s,r) => s.replace(r[1],r[0]), j)
: j.constructor == Array
? j.map(replaceD)
: j;

["__GT_infix", "simplify"].map(loadEnv);

var preAmble = (j) =>
j[0] != "define"
? ["__GT_infix", ["simplify", j]]
: j;

var identity = x => x;

var edgeCases = (j) =>
j[0] === "define"
&& j[2].constructor == Array && j[2][0] === "let"
&& j[1].constructor == String
? ["identity", "'let not allowed in variable definition'"]
: j;

var letFlat = (j) =>
// only nesting of two lets possible, but that is more than ok
j.constructor == Array && j[0] === "let" && j[2][0] === "let"
? ["let", j[1].concat(j[2][1]),j[2][2]]
: j.constructor == Array
? j.map(letFlat)
: j;

var modifyJson = (j) => preAmble(edgeCases(letFlat(replaceD(swapFirst(j)))));

var makeFun = (j, callBack) =>
"var " + j[1][0] + " = (" + j[1].slice(1) + ") => "
+ callBack(j[2]) +";";

var makeFunFun = (j, callBack) =>
"var " + j[1][0][0] + " = (" + j[1][0].slice(1) + ") => "
+ "(" + j[1].slice(1) +") => " + callBack(j[2]) + ";";

var smap = (f, v) =>
v.length === 1
? f(v[0]) +";"
: f(v[0]) +"; "  + smap(f, v.slice(1));

var makeLet = (j, callBack) =>
"{" + smap((l) => "let " + l[0] + " = " + callBack(l[1]), j[1])
+ " return " +  callBack(j[2]) + "; }"

var jsonToJs = (j) =>
j.constructor == Array && j[0] === "let"
? makeLet(j, jsonToJs)
:j.constructor == Array && j[0] === "define"
&& j[1].constructor == Array
&& j[1][0].constructor == Array
? makeFunFun(j, jsonToJs)
:j.constructor == Array && j[0] === "define"
&& j[1].constructor == Array
? makeFun(j, jsonToJs)
:j.constructor == Array && j[0] === "define"
&& j[1].constructor == String
? "var " + j[1] + " = " + jsonToJs(j[2]) + ";"
:j.constructor == String && j.substring(0, 8) == "_SYMBOL_"
? 'symbol("' + j.substring(8, j.length) + '")'
:j.constructor == Array
? jsonToJs(j[0]) + ".call(null,"  +  j.slice(1).map(jsonToJs) + ")"
: j;

var expressionToJs = (expr) =>
expr[expr.length-1] === " "
? jsonToJs(modifyJson(textToJson(expr)))
: "'add blank'";

["sin", "cos", "velocity", "dot_product",
"up", "Gamma", "compose", "definite_integral",
"coordinate", "minimize", "square", "partial",
"ref", "sqrt"].map(loadEnv);

var literal_function = sicmutils.abstract$.function$.literal_function;
var multidimensional_minimize = sicmutils.numerical.minimize.multidimensional_minimize;
var linear_interpolants = sicmutils.mechanics.lagrange.linear_interpolants;
var make_path = sicmutils.mechanics.lagrange.make_path;
var show_expression = identity;
    </code></pre>

    <pre>&lt;script&gt;
     var oldEval = window.eval;
     var newEval = (txt) =>
         txt[0] === "("
         ? oldEval(expressionToJs(txt))
         : oldEval(txt);
     window.eval = newEval;
&lt;/script&gt;</pre>

    <script>
     var oldEval = window.eval;
     var newEval = (txt) =>
         txt[0] === "("
         ? oldEval(expressionToJs(txt))
         : oldEval(txt);
     window.eval = newEval;
    </script>

    <h1>Start the Compiler</h1>

    <pre><code class="language-klipse-eval-js">
((1 / 2) / 2) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(3 * (1 / 2)) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(1 + (((2 / 3) - 4) * 5)) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(2 ^ 3) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(1 + (cos 0)) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(+ 1 (cos 0)) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
((sin ^ 2) (314 / 100)) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
((cos (sin 0)) + (((2 / 3) - 4) * (5 ^ 2))) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(+ (cos (sin 0)) (* (- (/ 2 3) 4) (expt 5 2))) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(3 * (cos 0)) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
((3 * cos) 0) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(cos 'x) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
((3 * (sin ^ 2)) 'x) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
((D (3 * (sin ^ 2))) 'x) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(define value 6) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(identity value) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(define (funame x) (x + 1)) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(funame 4) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(define ((ffuname x) y) (x + y)) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">

((ffuname 4) 5) 
    </code></pre>
    <pre><code class="language-klipse-eval-js">
(define (fulet x) (let ((y 1)) (+ x y))) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(fulet 4) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(1 + 1/2) 
    </code></pre>

    <h1>1 Lagrangian Mechanics</h1>

    <h2>1.4   Computing Actions</h2>

    <pre><code class="language-klipse-eval-js">
(define ((L-free-particle mass) local)
(let ((v (velocity local)))
(* 1/2 mass (dot-product v v)))) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(define q
 (up (literal-function 'x)
 (literal-function 'y)
 (literal-function 'z))) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
((Gamma q) 't) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
((compose (L-free-particle 'm) (Gamma q)) 't) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(define (Lagrangian-action L q t1 t2)
  (definite-integral (compose L (Gamma q)) t1 t2)) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(define (test-path t)
  (up (+ (* 4 t) 7)
      (+ (* 3 t) 5)
      (+ (* 2 t) 1))) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(Lagrangian-action (L-free-particle 3.0)
                   test-path 0.0 10.0) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(define ((make-eta nu t1 t2) t)
(* (- t t1) (- t t2) (nu t))) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(define ((varied-free-particle-action mass q nu t1 t2) eps)
  (let ((eta (make-eta nu t1 t2)))
    (Lagrangian-action (L-free-particle mass)
                       (+ q (* eps eta))
                       t1
                       t2))) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
((varied-free-particle-action 3.0 test-path
                              (up sin cos square)
                              0.0 10.0)
 0.001) 
    </code></pre>
    <pre><code class="language-klipse-eval-js">

(minimize 
  (varied-free-particle-action 3.0 test-path
   (up sin cos square)
    0.0 10.0)
  -2.0 1.0)
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(define ((parametric-path-action Lagrangian t0 q0 t1 q1) qs)
  (let ((path (make-path t0 q0 t1 q1 qs)))
    (Lagrangian-action Lagrangian path t0 t1))) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(define (find-path Lagrangian t0 q0 t1 q1 n)
  (let ((initial-qs (linear-interpolants q0 q1 n)))
    (let ((minimizing-qs
            (multidimensional-minimize
              (parametric-path-action Lagrangian t0 q0 t1 q1)
              initial-qs)))
      (make-path t0 q0 t1 q1 minimizing-qs)))) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(define ((L-harmonic m k) local)
  (let ((q (coordinate local))
        (v (velocity local)))
    (- (* 1/2 m (square v)) (* 1/2 k (square q))))) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(define q 
  (find-path (L-harmonic 1.0 1.0) 0.0 1.0 :pi/2 0.0 3))
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(- (cos 0.8) (q 0.8))
    </code></pre> 

    <h2>
        1.5   The Eulerâ€“Lagrange Equations
    </h2>
    <h3>
        1.5.2 Computing Lagrange's Equations
    </h3>

    <pre><code class="language-klipse-eval-js">
(define ((Lagrange-equations Lagrangian) q)
  (- (D (compose ((partial 2) Lagrangian) (Gamma q)))
     (compose ((partial 1) Lagrangian) (Gamma q)))) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(define (test-path t)
  (up (+ (* 'a t) 'a0)
      (+ (* 'b t) 'b0)
      (+ (* 'c t) 'c0))) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(((Lagrange-equations (L-free-particle 'm))
  test-path)
 't) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(show-expression
  (((Lagrange-equations (L-free-particle 'm))
    (literal-function 'x))
   't)) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(define (proposed-solution t)
  (* 'A (cos (+ (* 'omega t) 'phi)))) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(show-expression
  (((Lagrange-equations (L-harmonic 'm 'k))
    proposed-solution)
   't)) 
    </code></pre>

    <h4>
        Exercise 1.11: Kepler's third law
    </h4>

    <p>
        Show that a planet in circular orbit satisfies Kepler's third law 
        n^2a^3=G(M_1 + m_2), where n is the angular frequency of the orbit and a
        is the distance between sun and planet. (Hint: use the reduced mass to construct the Lagrangian)
    </p>

    <pre><code class="language-klipse-eval-js">
(define ((L-central-polar m V) local)
  (let ((q (coordinate local))
        (qdot (velocity local)))
    (let ((r (ref q 0))     (phi (ref q 1))
                            (rdot (ref qdot 0)) (phidot (ref qdot 1)))
      (- (* 1/2 m
            (+ (square rdot) (square (* r phidot))) )
         (V r))))) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(define ((gravitational-energy G m1 m2) r)
  (- (/ (* G m1 m2) r))) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(define (circle t)
  (up 'a (* 'n t))) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(define lagrangian-reduced
(L-central-polar (/ (* 'M_1 'm_2) (+ 'M_1 'm_2))
(gravitational-energy 'G 'M_1 'm_2))) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(((Lagrange-equations lagrangian-reduced) circle) 't) 
    </code></pre>
    <h2>
        1.6 How to find Lagrangians
    </h2>

    <pre><code class="language-klipse-eval-js">
(define ((L-uniform-acceleration m g) local)
  (let ((q (coordinate local))
        (v (velocity local)))
    (let ((y (ref q 1)))
      (- (* 1/2 m (square v)) (* m g y))))) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(show-expression
  (((Lagrange-equations
      (L-uniform-acceleration 'm 'g))
    (up (literal-function 'x)
        (literal-function 'y)))
   't)) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(define ((L-central-rectangular m U) local)
  (let ((q (coordinate local))
        (v (velocity local)))
    (- (* 1/2 m (square v))
       (U (sqrt (square q)))))) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(show-expression
  (((Lagrange-equations
      (L-central-rectangular 'm (literal-function 'U)))
    (up (literal-function 'x)
        (literal-function 'y)))
   't)) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(show-expression
  (((Lagrange-equations
      (L-central-polar 'm (literal-function 'U)))
    (up (literal-function 'r)
        (literal-function 'phi)))
   't)) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">
(define ((F->C F) local)
  (up (time local)
      (F local)
      (+ (((partial 0) F) local)
         (* (((partial 1) F) local)
            (velocity local))))) 
    </code></pre>

    <pre><code class="language-klipse-eval-js">

    </code></pre>

    <pre><code class="language-klipse-eval-js">
    </code></pre>



    <h1>
Footer of this html file
    </h1>

    <pre>
&lt;script src="https://storage.googleapis.com/app.klipse.tech/plugin_prod/js/klipse_plugin.min.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
    </pre>

<script src="https://storage.googleapis.com/app.klipse.tech/plugin_prod/js/klipse_plugin.min.js"></script>
</body>
</html>
